<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Interactive particle flow simulation of Van Gogh's Starry Night">
    <title>Van Gogh's Starry Night - Interactive Experience</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="header">
                <h2>The Starry Night</h2>
            </div>

            <div class="sidebar-header">
                <div class="tribute">
                    <p>A tribute to Vincent van Gogh's masterpiece</p>
                </div>
                <div class="action-buttons-row">
                    <button id="btnRandom" class="action-btn-small" title="Random">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8" cy="8" r="1.5"></circle><circle cx="16" cy="8" r="1.5"></circle><circle cx="8" cy="16" r="1.5"></circle><circle cx="16" cy="16" r="1.5"></circle><circle cx="12" cy="12" r="1.5"></circle></svg>
                    </button>
                    <button id="btnResetParams" class="action-btn-small" title="Reset Params">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                    </button>
                    <button id="btnReset" class="action-btn-small" title="Re-center">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                    <button id="btnFullscreen" class="action-btn-small" title="Full-Screen">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
                    </button>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Flow Strength</label>
                    <div class="slider-wrapper">
                        <input type="range" id="flowStrength" min="0.000" max="0.016" step="0.001" value="0.008">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Animation Speed</label>
                    <div class="slider-wrapper">
                        <input type="range" id="animationSpeed" min="0.3" max="0.7" step="0.1" value="0.5">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Zoom</label>
                    <div class="slider-wrapper">
                        <input type="range" id="zoom" min="2.5" max="5.1" step="0.1" value="3.8">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>

                <div class="control-group" style="margin-top: 20px;">
                    <label>Brightness</label>
                    <div class="slider-wrapper">
                        <input type="range" id="brightness" min="0.4" max="2.0" step="0.1" value="1.2">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Contrast</label>
                    <div class="slider-wrapper">
                        <input type="range" id="contrast" min="0.6" max="2.0" step="0.1" value="1.3">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Saturation</label>
                    <div class="slider-wrapper">
                        <input type="range" id="saturation" min="0.0" max="2.8" step="0.1" value="1.4">
                        <div class="slider-center-marker"></div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <div id="fps">Merry Christmas & Happy New Year!</div>
                <div class="credits">
                    <div class="credit-line">By <strong>DJzoom</strong> 加菲众</div>
                    <div class="credit-links">
                        <a href="https://x.com/DJWZ" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
                        <span class="separator">•</span>
                        <a href="https://github.com/djzoom/" target="_blank" rel="noopener noreferrer">GitHub</a>
                        <span class="separator">•</span>
                        <a href="https://github.com/djzoom/starry-night-flow" target="_blank" rel="noopener noreferrer">Project</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Content -->
        <div class="canvas-container">
            <div id="canvas-loading">正在加载星空...</div>
            <canvas id="canvas"></canvas>
        </div>
        
    </div>

    <!-- Load scripts in correct order -->
    <script src="image_data.js"></script>
    <!-- Three.js with multiple fallback CDNs -->
    <script>
        (function() {
            // 尝试多个 CDN 源加载 Three.js
            const threeJsSources = [
                'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js',
                'https://unpkg.com/three@0.128.0/build/three.min.js',
                'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js'
            ];
            
            let currentSourceIndex = 0;
            let threeJsLoaded = false;
            
            function tryLoadThreeJs() {
                if (typeof THREE !== 'undefined') {
                    threeJsLoaded = true;
                    console.log('Three.js already loaded');
                    triggerStartExperience();
                    return;
                }
                
                if (currentSourceIndex >= threeJsSources.length) {
                    console.error('All Three.js CDN sources failed to load');
                    const loadingEl = document.getElementById('canvas-loading');
                    if (loadingEl) {
                        loadingEl.textContent = 'Three.js 加载失败，请检查网络连接或刷新页面';
                    }
                    return;
                }
                
                const script = document.createElement('script');
                script.src = threeJsSources[currentSourceIndex];
                script.onload = () => {
                    threeJsLoaded = true;
                    console.log('Three.js loaded from:', threeJsSources[currentSourceIndex]);
                    triggerStartExperience();
                };
                script.onerror = () => {
                    console.warn('Failed to load Three.js from:', threeJsSources[currentSourceIndex]);
                    currentSourceIndex++;
                    tryLoadThreeJs();
                };
                document.head.appendChild(script);
            }
            
            function triggerStartExperience() {
                // 等待 script.js 加载完成
                if (typeof startExperience === 'function') {
                    startExperience();
                } else {
                    let attempts = 0;
                    const maxAttempts = 100; // 最多等待 5 秒
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (typeof startExperience === 'function') {
                            clearInterval(checkInterval);
                            startExperience();
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            console.error('script.js failed to load');
                            const loadingEl = document.getElementById('canvas-loading');
                            if (loadingEl) {
                                loadingEl.textContent = '脚本加载失败，请刷新页面';
                            }
                        }
                    }, 50);
                }
            }
            
            // 开始加载 Three.js
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', tryLoadThreeJs);
            } else {
                tryLoadThreeJs();
            }
        })();
    </script>
    <script src="script.js"></script>
</body>
</html>
